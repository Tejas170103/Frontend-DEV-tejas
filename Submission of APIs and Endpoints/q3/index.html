<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Q3 â€” Task Manager</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <style>
    body{font-family:Arial;margin:20px}
    .controls{margin-bottom:12px}
    .task{padding:8px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between}
    .left{display:flex;align-items:center}
    .title{margin-left:8px}
  </style>
  </head>
  <body>
    <h2>Task Manager</h2>
    <div class="controls">
      <label>Filter / Sort:
        <select id="filter">
          <option value>All</option>
          <option value="Low">Low Priority</option>
          <option value="Medium">Medium Priority</option>
          <option value="High">High Priority</option>
          <option value="completed">Completed</option>
        </select>
      </label>
    </div>

    <div id="list"></div>

    <script>
const API = 'http://localhost:3003/tasks';

function load(filter){
  let url = API;
  if (filter){
    if (filter === 'completed') url += '?completed=true';
    else url += '?priority=' + encodeURIComponent(filter);
  }
  $.ajax({
    url,
    method: 'GET',
    success(data){
      const list = $('#list').empty();
      if (!data.length) {
        list.html('<div style="color:#666">No tasks found</div>');
        return;
      }
      data.forEach(t => {
        const checked = t.completed ? 'checked' : '';
        const node = $(`
          <div class="task" data-id="${t.id}">
            <div class="left">
              <input type="checkbox" class="completed" ${checked}/>
              <div class="title"><strong>${t.title}</strong><div style="font-size:12px;color:#666">${t.priority} priority</div></div>
            </div>
            <div class="status">${t.completed ? 'Done' : 'Pending'}</div>
          </div>
        `);
        node.find('.completed').on('change', function(){
          toggleCompleted(t.id, !t.completed, node);
        });
        list.append(node);
      });
    },
    error(){
      $('#list').html('<div style="color:#b00020">Failed to load tasks</div>');
    }
  });
}

function toggleCompleted(id, newVal, node){
  // optimistic UI
  node.find('.status').text(newVal ? 'Done' : 'Pending');
  $.ajax({
    url: API + '/' + id,
    method: 'PATCH',
    contentType: 'application/json',
    data: JSON.stringify({completed: newVal}),
    success(resp){
      // ok
    },
    error(){
      // revert checkbox and status
      const cb = node.find('.completed');
      cb.prop('checked', !newVal);
      node.find('.status').text(!newVal ? 'Done' : 'Pending');
      alert('Failed to update task.');
    }
  });
}

$('#filter').on('change', function(){ load(this.value); });

// initial load
load('');
</script>
  </body>
</html>
